<?xml version="1.0" encoding="UTF-8"?>
<project name="quickquest" basedir="." default="pack">

	<property name="src.dir" value="src" />
	<property name="classes.dir" value="classes" />
	<property name="build.win32.dir" value="build-win32" />
	<property name="build.linux.dir" value="build-linux" />
	<property name="lib.dir" value="lib" />
	<property name="dist.dir" value="dist" />
	<property name="rel.ver.num" value="0.1" />
	<path id="master-linux-classpath">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
			<exclude name="testng*.jar" />
			<exclude name="qtjambi-4.7.1.jar" />
			<exclude name="qtjambi-win32-msvc2008-4.7.1.jar" />
		</fileset>
	</path>
	<path id="master-win32-classpath">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
			<exclude name="testng*.jar" />
			<exclude name="qtjambi-4.8.1.jar" />
		</fileset>
	</path>	
	<path id="manifest-cp-linux">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
			<exclude name="testng*.jar" />
			<exclude name="qtjambi*.jar" />
		</fileset>
	</path>
	<path id="manifest-cp-win32">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
			<exclude name="testng*.jar" />
		</fileset>
	</path>
	<target name="clean" description="Delete all generated files">
		<delete dir="${dist.dir}" failonerror="false" />
		<delete dir="${build.win32.dir}" failonerror="false" />
		<delete file="${ant.project.name}.jar" />
	</target>
	<target name="unzip-gbk" description="unzip those files whose file name are encoded with gbk">
		<unzip src="/home/bruce/aa.zip" dest="/home/bruce" encoding="gbk" />
	</target>

	<target name="jar-linux" depends="clean" description="build quick quest binary package">

		<mkdir dir="${build.linux.dir}" />

		<copy todir="${build.linux.dir}">
			<fileset dir="${src.dir}">
				<exclude name="**/*.java" />
			</fileset>
		</copy>

		<javac srcdir="${src.dir}" destdir="${build.linux.dir}" source="1.6" target="1.6" debug="on">

			<compilerarg line=" -encoding UTF-8" />
			<classpath refid="master-linux-classpath" />
		</javac>

		<manifestclasspath property="mcp-linux" jarfile="${ant.project.name}.jar">
			<classpath refid="manifest-cp-linux" />
		</manifestclasspath>
		<jar destfile="${ant.project.name}-linux.jar" basedir="${build.linux.dir}">
			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="bruce.oy@gmail.com" />
				<attribute name="Implementation-Title" value="QuickQuest" />
				<attribute name="Implementation-Version" value="0.1" />
				<attribute name="Class-Path" value="${mcp-linux}" />
				<attribute name="Main-Class" value="net.ubuntudaily.quickquest.Main" />
				<!-- details 
		      <section name="common/MyClass.class">
		        <attribute name="Sealed" value="false"/>
		      </section>-->
			</manifest>
		</jar>
	</target>
	<target name="jar-win32" depends="clean" description="build quick quest binary package">

		<mkdir dir="${build.win32.dir}" />

		<copy todir="${build.win32.dir}">
			<fileset dir="${src.dir}">
				<exclude name="**/*.java" />
			</fileset>
		</copy>

		<javac srcdir="${src.dir}" destdir="${build.win32.dir}" source="1.6" target="1.6" debug="on">

			<compilerarg line=" -encoding UTF-8" />
			<classpath refid="master-win32-classpath" />
		</javac>

		<manifestclasspath property="mcp-win32" jarfile="${ant.project.name}.jar">
			<classpath refid="manifest-cp-win32" />
		</manifestclasspath>
		<jar destfile="${ant.project.name}-win32.jar" basedir="${build.win32.dir}">
			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="bruce.oy@gmail.com" />
				<attribute name="Implementation-Title" value="QuickQuest" />
				<attribute name="Implementation-Version" value="0.1" />
				<attribute name="Class-Path" value="${mcp-win32}" />
				<attribute name="Main-Class" value="net.ubuntudaily.quickquest.Main" />
				<!-- details 
		      <section name="common/MyClass.class">
		        <attribute name="Sealed" value="false"/>
		      </section>-->
			</manifest>
		</jar>
	</target>
	<target name="pack" depends="jar-linux, jar-win32" description="pack a zip file which contains anything the end users need">
		<mkdir dir="${dist.dir}" />
		<zip destfile="${dist.dir}/quickquest-linux-${rel.ver.num}.zip">
			<fileset dir="." includes="${ant.project.name}-linux.jar,quickquest.sh, README.md, quickquest-icon-128x128.png">
				<include name="lib/**/*" />
				<exclude name="lib/**/testng*.jar" />
				<exclude name="lib/**/qtjambi*.jar" />
			</fileset>
		</zip>
		<zip destfile="${dist.dir}/quickquest-win32-${rel.ver.num}.zip">
			<fileset dir="." includes="${ant.project.name}-win32.jar,quickquest.bat, README.md, quickquest-icon-128x128.png">
				<include name="lib/**/*" />
				<exclude name="lib/**/testng*.jar" />
			</fileset>
		</zip>		
	</target>
</project>